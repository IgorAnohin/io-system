# Лабораторная работа 1

**Название:** "Разработка драйверов символьных устройств"

**Цель работы:** Получить знания и навыки разработки драйверов символьных устройств для операционной системы Linux

## Описание функциональности драйвера

В ходе записи текста в файл символьного устройства должен осуществляться подсчет введенных символов. При чтении созданного файла **/proc/var1** последовательность полученных с момента загрузки модуля ядра результатов (количество символов) должна выводиться в консоль пользователя.
При чтении из файла символьного устройства в кольцевой буфер ядра должен осуществляться вывод тех же данных, которые выводятся при чтении файла **/proc/var1**.

## Инструкция по сборке

```shell
$ sudo apt install libelf-dev
$
$ git clone https://github.com/IgorAnohin/io-system.git
$ cd io-system/lab1
$ make
```

## Инструкция пользователя
### Перед работой
1) Загрузить модуль с помощью команды `sudo insmod lab1.ko`
2) Проверить, что модуль был успешно загружен. Для этого нужно проверить вывод команды `dmesg | tail -1`. Вывод команды должен быть следующим:
```
lab1: successfully started: device=var1, proc=var1
```
3) Добавить себя в специальную группу или изменить права для устройства `/dev/var1`. Для изменения прав устройства нужно выполнить команду `sudo chmod 777 /dev/var1`

### Функции
- В символьное устройство можно записывать данные. Команда: `echo "something" > /dev/var1`
- Количество записанных символов можно прочитать. Команды для прочтения количества записанных символов:
    - Из символьного устройства: `cat /dev/var1`. Вывод будет в кольцевом буфере ядра
    - Из файловой системы **proc**: `cat /proc/var1`. Вывод будет в терминале

### После работы
1) Выгрузить модуль можно с помощью команды `sudo insmod lab1.ko`
2) Проверить, что модуль был успешно выгружен. Для этого нужно проверить вывод команды `dmesg | tail -1`. Вывод команды должен быть следующим:
```
lab1: successfully release all resources
```

## Примеры использования
Для демонстрации работы, запишем в висвольное устройство символы:
```sh
echo "HELLO" > /dev/var1
echo "WORLDDD" > /dev/var1
echo "123" > /dev/var1
echo "привет" > /dev/var
```
Прочитаем содердимое файла `/proc/var1`:
```sh
6
8
4
13
```

Теперь прочитаем содержимое символьного устройства `/dev/var1`, после проверим содержимое кольцевого буфера ядра:
```sh
[17714.307455] lab1: 6
[17714.307503] lab1: 8
[17714.307508] lab1: 4
[17714.307512] lab1: 13
```
Как можно заметить вывод совпадает с результатами при чтении файла `/proc/var1`

